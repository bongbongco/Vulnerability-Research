from os import listdir

fileNames = listdir('/Users/seungyonglee/ctf/sha_2017/HTTP')

# Decrypt routine, without changes
def decrypt(z):
    result = ""
    for I in range(len(z) / 64 + 1):
        a = z[I*64:(I+1)*64]
	
        b = "e4146d4252bafb3b38212df186497a7479d5e95af4796e7573a65e6849952032"
        c = "4141414141414141414141414141414141414141414141414141414141414141"
        for i in range(len(a) / 2):
            aa = ord(a[i*2:i*2 + 2].decode('hex'))
            bb = ord(b[i*2:i*2 + 2].decode('hex'))
            cc = ord(c[i*2:i*2 + 2].decode('hex'))
    	
            result = result + chr(aa ^ bb ^ cc)
    return result

# A flag placeholder (string is immutable :/ )
flag = [' ' for _ in range(40)]

# For all files
for fileName in fileNames:
    f = open('/Users/seungyonglee/ctf/sha_2017/HTTP/' + fileName, 'r')
    fc = f.read()
    # If it's a hit (the ordering of products is different)
    if fc.find('hyper') < fc.find('Traditional'):
        # fileName[23:] == Get only the ciphertext from filename
        r = decrypt(fileName[23:])
        
        # If the SQLi attempt targeted flag (not the SQL schema!)        
        if r.find('flag') != -1:
            chi = r.find("'") + 1
            if chi != 0:
                ch = r[chi]
            indi = r.find(',') + 1
            if indi != 0:
                ind = r[indi:indi+2]
                if ind[1] == ',':
                    ind = ind[0]
            if chi != 0:
                print ind, ch
                flag[int(ind)] = ch
            
print ''.join(flag)
