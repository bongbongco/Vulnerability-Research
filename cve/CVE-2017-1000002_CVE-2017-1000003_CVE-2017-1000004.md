# CVE-2017-1000002, CVE-2017-1000003, CVE-2017-1000004 (등록 예정)

오픈소스 온라인 학습 관리 시스템 [ATutor](http://www.atutor.ca/)에서 다수의 취약점이 발견됐다. 취약점이 패치된 새로운 2.2.2 버전을 릴리즈하였다. [ATutor Github](https://github.com/atutor/ATutor/releases/tag/atutor_2_2_2)에서 수정사항을 살펴보자.

## XSS 
* 삭제된 코드
```php
$_POST['title'] = $content_row['title'] = $addslashes($_POST['title']);
```

*addslashes* 함수는 데이터베이스 질의 등의 작업을 위해서 이스케이프해야할 문자 앞에 백슬래시를 붙여 반환하는 함수이다. 이스케이프되는 문자는 홑따옴표, 겹따옴표, 백슬래시, 널이다. 이스케이프되는 문자 종류에서 볼 수 있듯이 addslashes 함수는 스크립트 구문 삽입 공격에 대한 치환 용도로는 부적절하므로 이와 같이 크로스 사이트 스크립팅 취약점이 발생되었다.

* 추가된 코드
```php
        function clean_title($title){
             //strip any bad stuff off the title
             $title= htmlspecialchars_decode($title);
             // This might be problematic for multi sentence title?
             $title = preg_replace_callback('/([\?^\s])(.*)/', function ($str) {
                 return str_replace(array("'", '"', "&quot;"), '', $str[0]);    
                 }, $title);
             $title = preg_replace('/<(.*?)>(.*?)<(.*?)>/','',$title );
             $title = preg_replace('/>/','',$title );
             $title = preg_replace('/\"\'/','',$title );
             $title    = htmlspecialchars($title);
             return $title;
         }
 
         $_POST['title'] =  clean_title($_POST['title']);
```
*preg_replace* 함수는 
*htmlspecialchars* 함수는 
