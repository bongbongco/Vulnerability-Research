# CVE-2017-12425

[Varnish HTTP Cache](https://varnish-cache.org)는 HTTP Reverse Proxy로 알려진 웹 어플리케이션 accelerator이다. 최근 *Varnish HTTP Cache*에서 DoS(Denial-of-Service) 취약점 CVE-2017-12425이 보고되었다.  

## <i class="icon-bug"></i> Bug
### Versions affected
- 4.0.1 to 4.0.4
- 4.1.0 to 4.1.7
- 5.0.0
- 5.1.0 to 5.1.2

*Varnish VCL snippets* 사용 시 `Transfer-encoding: chunked`를 시도한 클라이언트의 요청 본문 값을 더 크게 전송할 경우 Varnish 데몬이 재시작되는 일이 발생했다. 일반적으로는 `chunk` 요청을 하지 않지만 B2B 어플리케이션이나 API와 같은 분야에서는 사용되는 경우들이 있다.  기존에 존재한 if 검증 로직은 아래와 같다. 음수 값(64-bit signed integer보다 큰 사이즈로 표현됨)을 이용하여 DoS 공격이 발생하게 된다.

```c
cl = (ssize_t) cll;
if ((uintmax_t) cl! = cll)
``` 
실제 요청 값이 큰 값으로 위조된 것이 아닌 지 확인하는 로직이 존재했지만, 음수에 대한 조건이 누락되어 

참고 : [Github Issue page](https://github.com/varnishcache/varnish-cache/issues/2379)

## <i class="icon-pencil"></i> Fix
```c
                if (q == NULL || *q != '\0')
                        ERR("chunked header number syntax");
                cl = (ssize_t)cll;
-               if((uintmax_t)cl != cll)
+               if (cl < 0 || (uintmax_t)cl != cll)
                        ERR("bogusly large chunk size");

                *priv = cl;
```
참고 : [Github Commit Page](https://github.com/varnishcache/varnish-cache/commit/09731b24b2225e3c0d66d3ec1b4fedef6fa22b6e)
