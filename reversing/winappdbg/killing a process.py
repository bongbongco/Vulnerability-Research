from winappdbg import System, Process, HexDump
import sys

def print_threads_and_modules(pid):

    process = Process(pid)
    print "Process %d" % process.get_pid()

    print "Threads:"
    for thread in process.iter_threads():
        print "\t %d" % thread.get_tid()

    print "Modules:"
    bits = process.get_bits()
    for module in process.iter_modules():
        print "\t%s\t%s" % (
                HexDump.address(module.get_base(), bits),
                module.get_filename()
                )

def starting_process(path:
    system = System()
    process = system.start_process(path)
    print "Started process %d (%d bits)" % (process.get_pid(), process.get_bits())
    return process.get_pid()

def stoping_process(pid):
    process = Process(pid)
    process.kill()
    print "Kill process"

if __name__ =="__main__":
    #system = System()
    #pid = system.argv_to_cmdline(sys.argv[1:])
    #print_threads_and_modules(int(pid))

    path = "C:\\Program Files (x86)\\GRETECH\\GOMAudio\\Goma.exe"
    pid = starting_process(path)
    print_threads_and_modules(pid)
    stoping_process(pid)

